{% extends 'website/base.html' %}

{% block title %}{{article.title}}{% endblock %}

{% block content %}
{% load markdown_extras %}

<div>
	<div class="flex-centered">
		<h2>{{article.title}}</h2>
	</div>

	<div class="flex-centered">
		{% load static %}
		<small>
			<img src="{% static 'website/img/calendar.png' %}" height="12">{{article.last_update}}
			&nbsp;
			<img src="{% static 'website/img/comment.png' %}" height="12">{{comments|length}}
			&nbsp;
			<img src="{% static 'website/img/eye.png' %}" height="12">{{article.nb_views}}
		</small>
	</div>

	<br>

	<div class="columns">
		<div class="column col-9 col-sm-12">
			<div class="show-sm"><img src="{{ MEDIA_URL }}/{{article.photo}}" class="img-responsive"></div>
			{{article.content | markdown | safe}}
		</div>
		<div class="column col-3">
			<div class="hide-sm"><img src="{{ MEDIA_URL }}/{{article.photo}}" class="img-responsive"></div>

			<div class="panel">
				<form action="/thumb_up/article/{{article.id}}/" method="post">
					<button class="btn tooltip tooltip-left btn-action s-circle" data-tooltip="Like this article" type="submit" name="upvote" value="yes">
						{% csrf_token %}
						<img src="{% static 'website/img/thumb_big.png' %}" height="24">
					</button>	
				</form>
				{% for s in suggestions %}
					{{s.title}}
					<br>
				{% endfor %}
			</div>
		</div>
	</div>
</div>

<div class="divider text-center" data-content="COMMENTS"></div>
<div class="columns">
	<div class="column col-sm-12">
		<div class="panel">

			<div class="panel-nav">
    			<!-- navigation components: tabs, breadcrumbs or pagination -->
  			</div>

			<div class="panel-body">
				{% for c in comments %}
					{% if c.parent is null %}
						<figure class="avatar avatar-sm" data-initial="{{c.author|make_list|first}}" style="background-color: #5755d9;">
						</figure>
					
						<b>{{c.author}}</b>
						<i>{{c.date}}</i>
						<div class="float-right">
							<button id="btn_comment_{{c.id}}" class="btn tooltip tooltip-left" data-tooltip="Answer to {{c.author}}" onclick="changeField('id_parent',{{c.id}},'answer_to','block', 'answer_name', '{{c.author}}')" >
								<i class="icon icon-message"></i>
							</button>
							
						</div>
						
						{{ c.content | markdown | safe}}
						<!--TODO find a smarter to iterate?: https://stackoverflow.com/questions/12014704/iterating-over-related-objects-in-django-loop-over-query-set-or-use-one-liner-s-->
						{% for s in comments %}
							{% if s.parent == c %}
								<div class="float-right">
									<b>{{s.author}}</b>
									<figure class="avatar avatar-xs" data-initial="{{s.author|make_list|first}}" style="background-color: #5755d9;">
									</figure>
								</div>
								<div class="float-right">
									{{s.content}}
								</div>
								<br>
								
							{% endif %}
						{% endfor %}
						<br>
					{% endif %}
				{% endfor %}
			</div>
		</div>
	</div>

	<div class="column col-sm-12">
		<div id="answer_to" class="toast" style="display: none;">
			<button class="btn btn-clear float-right" onclick="changeField('id_parent',null,'answer_to','none', 'answer_name', '')"></button>
  			You are answering to <span id="answer_name"></span>
		</div>
		<form method="post">
			<div class="form-group">
				{% csrf_token %}
	  			{{comment_form}}
	  			<div class="float-right"><button class="btn btn-primary">comment</button></div>
	  		</div>
	  	</form>
	</div>

</div>
{% endblock %}